<!DOCTYPE html>
<html>
<head>
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</title>
    <style>
        /* –°—Ç–∏–ª–∏ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞ */
        .preview-img { max-width: 200px; max-height: 150px; }
        .upload-section { border: 2px dashed #ccc; padding: 20px; margin: 10px 0; }
    </style>
</head>
<body>
    <div id="login">
        <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞">
        <button onclick="login()">–í–æ–π—Ç–∏</button>
    </div>

    <div id="panel" style="display: none;">
        <div class="case-editor">
            <h2>–†–µ–¥–∞–∫—Ç–æ—Ä –∫–µ–π—Å–æ–≤</h2>
            <div id="currentImage">
                <img class="preview-img" id="thumbPreview">
                <img class="preview-img" id="fullPreview">
            </div>
            
            <div class="upload-section">
                <h3>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</h3>
                <input type="file" id="fileInput">
                <button onclick="uploadImage('thumb')">–ó–∞–≥—Ä—É–∑–∏—Ç—å –º–∏–Ω–∏–∞—Ç—é—Ä—É</button>
                <button onclick="uploadImage('full')">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–ª–Ω–æ–µ —Ñ–æ—Ç–æ</button>
            </div>

            <div class="form">
                <textarea id="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ"></textarea>
                <input type="text" id="articleUrl" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ —Å—Ç–∞—Ç—å—é">
                <input type="text" id="articleTitle" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–∞—Ç—å–∏">
                <button onclick="saveCase()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–µ–π—Å</button>
            </div>
        </div>

        <div class="cases-list">
            <h2>–í—Å–µ –∫–µ–π—Å—ã</h2>
            <div id="casesContainer"></div>
        </div>
    </div>

    <script>
        let currentCase = null;
        let authToken = null;

        async function login() {
            authToken = document.getElementById('password').value;
            try {
                const response = await fetch(`/api/cases?password=${authToken}`);
                if(response.ok) {
                    document.getElementById('login').style.display = 'none';
                    document.getElementById('panel').style.display = 'block';
                    loadCases();
                }
            } catch(e) {
                alert('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
            }
        }

        async function uploadImage(type) {
            const fileInput = document.getElementById('fileInput');
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            formData.append('type', type);

            try {
                const response = await fetch(`/api/upload?password=${authToken}`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                if(type === 'thumb') {
                    document.getElementById('thumbPreview').src = data.path;
                } else {
                    document.getElementById('fullPreview').src = data.path;
                }
            } catch(e) {
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
            }
        }

        async function saveCase() {
            const caseData = {
                thumb: document.getElementById('thumbPreview').src,
                full: document.getElementById('fullPreview').src,
                description: document.getElementById('description').value,
                article: {
                    url: document.getElementById('articleUrl').value,
                    title: document.getElementById('articleTitle').value
                }
            };

            try {
                const response = await fetch('/api/save?password=${authToken}', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(caseData)
                });
                
                if(response.ok) {
                    alert('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!');
                    loadCases();
                }
            } catch(e) {
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
            }
        }

        async function loadCases() {
            const response = await fetch(`/api/cases?password=${authToken}`);
            const data = await response.json();
            renderCases(data.cases);
        }

        function renderCases(cases) {
            const container = document.getElementById('casesContainer');
            container.innerHTML = cases.map((c, i) => `
                <div class="case-item">
                    <img src="${c.thumb}" class="preview-img">
                    <p>${c.description}</p>
                    <button onclick="editCase(${i})">‚úèÔ∏è</button>
                    <button onclick="deleteCase(${i})">üóëÔ∏è</button>
                </div>
            `).join('');
        }

        function editCase(index) {
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∫–µ–π—Å–∞ –≤ —Ñ–æ—Ä–º—É
        }

        async function deleteCase(index) {
            // –£–¥–∞–ª–µ–Ω–∏–µ –∫–µ–π—Å–∞
        }
    </script>
</body>
</html>